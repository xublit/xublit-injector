{"version":3,"sources":["../src/module-loader.es6"],"names":[],"mappings":"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","file":"module-loader.js","sourcesContent":["import * as path from 'path';\nimport * as fs from 'fs';\n\nexport function parsePath (includeDirPath) {\n\n    var searchDir;\n    var includeDirs;\n\n    var pathParts = includeDirPath.split(path.sep);\n    if (pathParts.slice(0).pop().indexOf('*') > -1) {\n        includeDirs = wildcardDirnameToRegExp(pathParts.pop());\n    }\n\n    searchDir = pathParts.join(path.sep);\n\n    return {\n        searchDir: searchDir,\n        includeDirs: includeDirs,\n    };\n\n}\n\nexport function wildcardDirnameToRegExp (dirname) {\n    return new RegExp(\n        '^' + dirname.replace('*', '[A-Z-_.]+') + '$',\n        'i'\n    );\n}\n\nexport function loadModulesIn (includeDirPaths) {\n\n    var potentials = {};\n    var modules = [];\n\n    includeDirPaths.forEach((includeDirPath) => {\n\n        var parsedPath = parsePath(includeDirPath);\n\n        var searchDir = parsedPath.searchDir;\n        var opts = {};\n\n        if (parsedPath.includeDirs) {\n            opts.includeDirs = parsedPath.includeDirs;\n        }\n\n        Object.assign(potentials, findXublits(searchDir, opts));\n\n    });\n\n    Object.values(potentials).forEach((module) => {\n\n        if (!isInjectorModule(module)) {\n            return;\n        }\n\n        modules.push(module);\n\n    });\n\n    return modules;\n\n}\n\nexport function isInjectorModule (module) {\n    \n    if (!module) {\n        return false;\n    }\n\n    if (!module.ref) {\n        return false;\n    }\n\n    if (!module.bootstrap || 'function' !== typeof module.bootstrap) {\n        return false;\n    }\n\n    if (!module.inject || !Array.isArray(module.inject)) {\n        return false;\n    }\n\n    return true;\n\n}\n\nfunction findXublits (dirname, opts) {\n    \n    opts = opts || {};\n\n    var potentialsInThisDir = {};\n    var includeDirs = 'includeDirs' in opts ? opts.includeDirs : /^[^\\.]{1,2}/;\n    var recursive = 'recursive' in opts ? opts.recursive : true;\n\n    function includeDirectory (dirname) {\n        return recursive || includeDirs.test(dirname);\n    }\n\n    var filenames = fs.readdirSync(dirname);\n\n    filenames.forEach((filename) => {\n\n        var filepath = dirname + '/' + filename;\n\n        var isDirectory = fs.statSync(filepath).isDirectory();\n        if (!isDirectory) {\n\n            var match = /\\.(js|json|node|es6)$/i.test(filename);\n            if (match) {\n                var module = tryToRequire(filepath);\n                if (module) {\n                    potentialsInThisDir[filepath] = module;\n                }\n            }\n\n            return;\n\n        }\n\n        var potentialsInSubDirs = findXublits(filepath, {\n            includeDirs: includeDirs,\n        });\n\n        Object.assign(potentialsInThisDir, potentialsInSubDirs);\n\n    });\n\n    return potentialsInThisDir;\n\n}\n\nfunction tryToRequire (path) {\n    try {\n        return require(path);\n    }\n    catch (error) {\n        if ('MODULE_NOT_FOUND' === error.code) {\n            return undefined;\n        }\n        throw error;\n    }\n}"]}